{"version":3,"sources":["background.coffee"],"names":[],"mappings":"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","file":"background.js","sourceRoot":"/source/","sourcesContent":["now = moment()\nrootFoldername = null\ntabId = null\n\nids =\n  root: null\n  year: null\n  month: null\n  date: null\n\ntitles =\n  root: 'とりブ'\n  year: '' + now.year()\n  month: '' + (now.month() + 1)\n  date: '' + now.date()\n\n\nchrome.runtime.onInstalled.addListener ->\n  chrome.storage.local.get 'foldername', (cb) ->\n    if not cb.foldername?\n      chrome.storage.local.set {foldername: titles.root} , ->\n\nisURL = (str) ->\n  re = /^(https?:\\/\\/)?([\\da-z\\.-]+)\\.([a-z\\.]{2,6})([\\/\\w \\.-]*)*\\/?$/\n  re.test str\n\ninsertCSSs = (id, files) ->\n  for file in files\n    chrome.tabs.insertCSS id, {file: \"style/#{file}\"}, ->\n\nexecuteScripts = (id, files) ->\n  for file in files\n    chrome.tabs.executeScript id, {file: \"script/#{file}\"}, ->\n\n# HTML(text)を取得\ngetText = (url) ->\n  new Promise (resolve, reject) ->\n    if isURL url\n      xhr = new XMLHttpRequest()\n      xhr.open 'GET', url, true\n\n      xhr.onreadystatechange = ->\n        if xhr.readyState is 4\n          resolve xhr.responseText\n\n      xhr.send()\n    else\n      reject 123\n\n# HTML(text)から<title>の中身を取り出す\ncutTitle = (txt) ->\n  new Promise (resolve) ->\n    re = /<title>(.*)<\\/title>/i\n    resolve txt.match(re)[1]\n\n# ルートフォルダ名をストレージから取ってくる\ngetRootFolderName = ->\n  new Promise (resolve) ->\n    chrome.storage.local.get 'foldername', (cb) ->\n      resolve cb.foldername\n\n# タイプに応じてchrome.bookmarks.createに使うパラメータを返す\nmakeFolderParams = (folderType) ->\n  params =\n    index: 0\n    parentId: null\n    title: null\n\n  switch folderType\n    when 'root'\n      params.parentId = '1'\n      params.title = titles.root\n    when 'year'\n      params.parentId = '' + ids.root\n      params.title = '' + titles.year\n    when 'month'\n      params.parentId = '' + ids.year\n      params.title = '' + titles.month\n    when 'date'\n      params.parentId = '' + ids.month\n      params.title = '' + titles.date\n\n  # console.log params\n  params\n\ncreateFolder = (folderType) ->\n  folderParams = makeFolderParams folderType\n\n  new Promise (resolve) ->\n    chrome.bookmarks.create folderParams, (bookmark) ->\n      resolve bookmark.id\n\n# nodes中の一番最初にtitleが一致したnodeを返す\nfilterNodeByTitle = (nodes, title) ->\n  eqNode = null\n\n  for node in nodes\n    if node.title is title\n      eqNode = node\n      break\n\n  Promise.resolve eqNode\n\n# 指定フォルダ内のブックマークをすべて取得\ngetTreeNodes = (parentId) ->\n  new Promise (resolve) ->\n    chrome.bookmarks.getSubTree parentId, (cb) ->\n      resolve cb[0].children\n\n# フォルダ(parentId)内にある、titleフォルダのidを返す\nfilterTitlesIdByTitle = (parentId, title) ->\n  new Promise (resolve, reject) ->\n    getTreeNodes parentId\n    .then (nodes) ->\n      filterNodeByTitle nodes, title\n    .done (node) ->\n      if node?\n        resolve node.id\n      else\n        reject()\n\n# タイプに応じて、親フォルダのidを返す\ngetTitlesParentId = (type) ->\n  switch type\n    when 'root' then '1'\n    when 'year' then ids.root\n    when 'month' then ids.year\n    when 'date' then ids.month\n\n# タイプに応じて、それ自身のidを返す\ngetId =  (folderType) ->\n  id = getTitlesParentId folderType\n\n  new Promise (resolve) ->\n    filterTitlesIdByTitle id, titles[folderType]\n    .catch ->\n      createFolder folderType\n    .done (id) ->\n      resolve id\n\n# 日付に応じて、ブックマークを保存する\n# (e.g.) 2015/01/01 なら [2015]>[1]>[1] へ保存\n# 結果として、画面にアラートを表示させる\naddBookmark = (tab) ->\n  getRootFolderName()\n\n  .then (name) ->\n    titles.root = name\n    getId 'root'\n\n  .then (rootId) ->\n    ids.root = rootId\n    getId 'year'\n\n  .then (yearId) ->\n    ids.year = yearId\n    getId 'month'\n\n  .then (monthId) ->\n    ids.month = monthId\n    getId 'date'\n\n  .done (dateId) ->\n    chrome.bookmarks.create\n      index: 0\n      parentId: '' + dateId\n      title: tab.title\n      url: tab.url\n\n    executeScripts tab.id, ['alert.js']\n    console.log 'complete'\n\nchrome.browserAction.onClicked.addListener (tab) ->\n  insertCSSs tab.id, ['icono.min.css', 'contentscripts.css']\n  addBookmark tab\n\nchrome.contextMenus.create\n  title: 'とりあえずブックマーク'\n  id: 'pageBookmark'\n\nchrome.contextMenus.create\n  title: 'リンク先をとりあえずブックマーク'\n  id: 'linkBookmark'\n  contexts: ['link']\n\nchrome.contextMenus.onClicked.addListener (info, tab) ->\n  insertCSSs tab.id, ['icono.min.css', 'contentscripts.css']\n  switch info.menuItemId\n    when 'pageBookmark'\n      addBookmark tab\n    when 'linkBookmark'\n      tabId = tab.id\n      executeScripts tab.id, ['exec.js']\n\nchrome.runtime.onMessage.addListener (cb) ->\n  if cb.id is 'linkBookmark'\n    tab =\n      id: tabId\n      url: cb.url\n      title: null\n\n    getText tab.url\n    .then (txt) ->\n      cutTitle txt\n    .done (title) ->\n      tab.title = title\n      addBookmark tab\n    , ->\n      executeScripts tab.id, ['error.js']\n"]}